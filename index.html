<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Dang ❤️ Khanh &mdash; Wedding </title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Free HTML5 Template by FREEHTML5.CO" />
	<meta name="keywords" content="free html5, free template, free bootstrap, html5, css3, mobile first, responsive" />
	<meta name="author" content="DangPK & KhanhNTN" />


  	<!-- Facebook and Twitter integration -->
	<meta property="og:title" content=""/>
	<meta property="og:image" content=""/>
	<meta property="og:url" content=""/>
	<meta property="og:site_name" content=""/>
	<meta property="og:description" content=""/>
	<meta name="twitter:title" content="" />
	<meta name="twitter:image" content="" />
	<meta name="twitter:url" content="" />
	<meta name="twitter:card" content="" />

	<link href='https://fonts.googleapis.com/css?family=Work+Sans:400,300,600,400italic,700' rel='stylesheet' type='text/css'>
	<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Satisfy" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css">
	
	
	<!-- Animate.css -->
	<link rel="stylesheet" href="css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="css/icomoon.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="css/bootstrap.css">

	<!-- Magnific Popup -->
	<link rel="stylesheet" href="css/magnific-popup.css">

	<!-- Owl Carousel  -->
	<link rel="stylesheet" href="css/owl.carousel.min.css">
	<link rel="stylesheet" href="css/owl.theme.default.min.css">

	<!-- Theme style  -->
	<link rel="stylesheet" href="css/style.css">

	<!-- Modernizr JS -->
	<script src="js/modernizr-2.6.2.min.js"></script>

	<!-- FOR IE9 below -->
	<!--[if lt IE 9]>
	<script src="js/respond.min.js"></script>
	<![endif]-->

	</head>
	<body>
		
	<div class="fh5co-loader"></div>
	
	<div id="page">
	<nav class="fh5co-nav" role="navigation">
		<div class="container">
			<div class="row">
				<div class="col-xs-2">
					<div id="fh5co-logo"><a href="index.html">Wedding<strong>.</strong></a></div>
				</div>
				<div class="col-xs-10 text-right menu-1">
					<ul>
						<li class="active"><a href="#fh5co-couple" class="scroll-link">Home</a></li>
						<li><a href="#fh5co-event" class="scroll-link">Event</a></li>
						<li><a href="#fh5co-couple-story" class="scroll-link">Story</a></li>
						<li><a href="#fh5co-gallery" class="scroll-link">Gallery</a></li>
						<li><a href="#gift-box" class="scroll-link">Gift</a></li>
					</ul>
				</div>
			</div>
			
		</div>
	</nav>

	<header id="fh5co-header" class="fh5co-cover nav-dark-bg" role="banner" style="background-image:url(images/img_bg_2.jpg);" data-stellar-background-ratio="0.5">
		<div class="overlay"></div>
		<div class="container">
			<div class="row">
				<div class="col-md-8 col-md-offset-2 text-center">
					<div class="display-t">
						<div class="display-tc animate-box" data-animate-effect="fadeIn">
							<h1 style="font-size: 65px;">Khoa Đăng &amp; Ngọc Khánh</h1>
							<div class="simply-countdown simply-countdown-one"></div>
							<!-- <p><a href="#" class="btn btn-default btn-sm">Save the date</a></p> -->
							<p>
								<span class="wedding-date-text">Chủ Nhật, Ngày 21 tháng 12 năm 2025</span>
							</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</header>

	<div id="fh5co-couple" class="nav-light-bg">
		<div class="container">
			<div class="row">
				<div class="col-md-8 col-md-offset-2 text-center fh5co-heading animate-box">
					<h2>Hello!</h2>
					<!-- <h3>21 Tháng 12 Năm 2025</h3> -->
					<!-- <p>We invited you to celebrate our wedding</p> -->
					 <svg viewBox="0 0 500 100" class="line-drawing-text-small">
					<text id="text-dang-small"
						x="210" y="50"
						dominant-baseline="middle"
						text-anchor="end"> Đăng
					</text>

					<path id="heart-shape-small" class="heart-path"
					d="M250,45
					C245,30 225,30 225,50
					C225,65 250,75 250,90
					C250,75 275,65 275,50
					C275,30 255,30 250,45Z"
					transform="translate(0, -15)"
					stroke-linecap="round" stroke-linejoin="round">
					</path>

					<text id="text-khanh-small"
						x="285" y="50"
						dominant-baseline="middle"
						text-anchor="start"> Khánh
					</text>
				</svg>
				</div>
			</div>
			<div class="couple-wrap animate-box">
				<div class="couple-half">
					<div class="groom">
						<img src="images/groom.jpg" alt="groom" class="img-responsive">
					</div>
					<div class="desc-groom">
						<h3>Khoa Đăng</h3>
						<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove</p>
					</div>
				</div>
				<p class="heart text-center"><i class="icon-heart2"></i></p>
				<div class="couple-half">
					<div class="bride">
						<img src="images/bride.jpg" alt="groom" class="img-responsive">
					</div>
					<div class="desc-bride">
						<h3>Ngọc Khánh</h3>
						<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove</p>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div id="fh5co-event" class="fh5co-bg nav-dark-bg" style="background-image:url(images/img_bg_3.jpg);">
		<div class="overlay"></div>
		<div class="container">
			<div class="row">
				<div class="col-md-8 col-md-offset-2 text-center fh5co-heading animate-box">
					<span>Our Special Events</span>
					<h2>Wedding Events</h2>
				</div>
			</div>
			<div class="row">
				<div class="display-t">
					<div class="display-tc">
						<div class="col-md-10 col-md-offset-1">
							<div class="col-md-6 col-sm-6 text-center">
								<div class="event-wrap animate-box">
									<h3>Nhà Gái</h3>
									<div class="event-col">
										<i class="icon-clock"></i>
										<span>16:00</span>
									</div>
									<div class="event-col">
										<i class="icon-calendar"></i>
										<span>Thứ 7 Ngày 20</span>
									</div>
									<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p>
								</div>
							</div>
							<div class="col-md-6 col-sm-6 text-center">
								<div class="event-wrap animate-box">
									<h3>Nhà Trai</h3>
									<div class="event-col">
										<i class="icon-clock"></i>
										<span>10:30</span>
									</div>
									<div class="event-col">
										<i class="icon-calendar"></i>
										<span>Chủ Nhật Ngày 21</span>
									</div>
									<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div id="fh5co-couple-story" class="nav-light-bg">
		<div class="container">
			<div class="row">
				<div class="col-md-8 col-md-offset-2 text-center fh5co-heading animate-box">
					<span>We Love Each Other</span>
					<h2>Our Story</h2>
					<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts.</p>
				</div>
			</div>
			<div class="row">
				<div class="col-md-12 col-md-offset-0">
					<ul class="timeline animate-box">
						<li class="animate-box">
							<div class="timeline-badge" style="background-image:url(images/couple-1.jpg);"></div>
							<div class="timeline-panel">
								<div class="timeline-heading">
									<h3 class="timeline-title">First We Meet</h3>
									<span class="date">December 25, 2015</span>
								</div>
								<div class="timeline-body">
									<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p>
								</div>
							</div>
						</li>
						<li class="timeline-inverted animate-box">
							<div class="timeline-badge" style="background-image:url(images/couple-2.jpg);"></div>
							<div class="timeline-panel">
								<div class="timeline-heading">
									<h3 class="timeline-title">First Date</h3>
									<span class="date">December 28, 2015</span>
								</div>
								<div class="timeline-body">
									<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p>
								</div>
							</div>
						</li>
						<li class="animate-box">
							<div class="timeline-badge" style="background-image:url(images/couple-3.jpg);"></div>
							<div class="timeline-panel">
								<div class="timeline-heading">
									<h3 class="timeline-title">In A Relationship</h3>
									<span class="date">January 1, 2016</span>
								</div>
								<div class="timeline-body">
									<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p>
								</div>
							</div>
						</li>
			    	</ul>
				</div>
			</div>
		</div>
	</div>

	<div id="fh5co-gallery" class="fh5co-section-gray nav-light-bg">
		<div class="container">
			<div class="row">
				<div class="col-md-8 col-md-offset-2 text-center fh5co-heading animate-box">
					<span>Our Memories</span>
					<h2>Wedding Gallery</h2>
					<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts.</p>
				</div>
			</div>
			<div class="row row-bottom-padded-md">
				<div class="col-md-12">
					<ul id="fh5co-gallery-list">
						
						<li class="one-third animate-box" data-animate-effect="fadeIn" style="background-image: url(images/gallery-1.jpg); "> 
						<a href="images/gallery-1.jpg" class="color-4 gallery-popup"></a>
					</li>
					<li class="one-third animate-box" data-animate-effect="fadeIn" style="background-image: url(images/gallery-2.jpg); ">
						<a href="images/gallery-2.jpg" class="color-4 gallery-popup"></a>
					</li>
					<li class="one-third animate-box" data-animate-effect="fadeIn" style="background-image: url(images/gallery-3.jpg); ">
						<a href="images/gallery-3.jpg" class="color-3 gallery-popup"></a>
					</li>
					<li class="one-third animate-box" data-animate-effect="fadeIn" style="background-image: url(images/gallery-4.jpg); ">
						<a href="images/gallery-4.jpg" class="color-4 gallery-popup"></a>
					</li>

					<li class="one-third animate-box" data-animate-effect="fadeIn" style="background-image: url(images/gallery-5.jpg); ">
						<a href="images/gallery-5.jpg" class="color-3 gallery-popup"></a>
					</li>
					<li class="one-third animate-box" data-animate-effect="fadeIn" style="background-image: url(images/gallery-6.jpg); ">
						<a href="images/gallery-6.jpg" class="color-4 gallery-popup"></a>
					</li>
					<li class="one-third animate-box" data-animate-effect="fadeIn" style="background-image: url(images/gallery-7.jpg);">
						<a href="images/gallery-7.jpg" class="color-4 gallery-popup"></a>
					</li>

					<li class="one-third animate-box" data-animate-effect="fadeIn" style="background-image: url(images/gallery-8.jpg); "> 
						<a href="images/gallery-8.jpg" class="color-5 gallery-popup"></a>
					</li>
					<li class="one-third animate-box" data-animate-effect="fadeIn" style="background-image: url(images/gallery-9.jpg); ">
						<a href="images/gallery-9.jpg" class="color-6 gallery-popup"></a>
					</li>
					</ul>		
				</div>
			</div>
		</div>
	</div>

	<!-- <section id="gift-box" class="gift-box-section nav-light-bg">
		<div class="container" style="margin-top: 20px;">
			<div class="row">
				<div class="col-md-12 text-center fh5co-heading" style="margin-bottom: 0;">
					<h2>Mừng Cưới</h2>
					<p style="font-size: 1.1em; margin-bottom: 40px; color: #555;">Thật vui vì được gặp và đón tiếp các bạn trong một dịp đặc biệt như đám cưới của chúng tôi! ♥</p>
				</div>
			</div>
			<div class="row">
				<div class="col-md-6 text-center animate-box fh5co-heading">
					<div class="qr-card-frame">
						<h3>Về chú rể</h3>
						<img src="images/DangPK.png" alt="QR Code Chú Rể">
						<p style="font-size: 1.1em; margin-top: 15px;">
							<strong>Khoa Đăng</strong><br>
							STK: 123456<br>
							TechCombank
						</p>
					</div>
				</div>
				<div class="col-md-6 text-center animate-box">
					<div class="qr-card-frame">
						<h3>Về cô dâu</h3>
						<img src="images/DangPK.png" alt="QR Code Cô Dâu">
						<p style="font-size: 1.1em; margin-top: 15px;">
							<strong>Ngọc Khánh</strong><br>
							STK: 123456<br>
							TechCombank
						</p>
					</div>
				</div>
			</div>
		</div>
	</section> -->

	<div id="fh5co-message" class="nav-light-bg" style="margin-top: -30px;">
		<div class="container">
			<div class="row">
				<div class="col-md-8 col-md-offset-2 text-center fh5co-heading animate-box">
					<h2>Gửi Lời Chúc</h2>
				</div>
			</div>
			<div class="row">
				<div class="main-content text-center">
				<p class="lead" style="color:#7a6c6c; margin-bottom: 40px;">
					Cảm ơn bạn rất nhiều vì đã gửi những lời chúc mừng tốt đẹp nhất đến đám cưới của chúng tôi!
				</p>

				<div class="row">
					
					<div class="col-md-6">
						<div class="frame-box" style="height: 470px;">
							<form id="messageForm">
								<div class="row">
									<div class="col-xs-12">
										<div class="form-group text-left">
											<label for="nameInput" class="sr-only">Nhập họ tên*</label>
											<input type="text" id="nameInput" name="Name" required
											class="form-control form-control-custom"
											placeholder="Nhập họ tên*">
										</div>
									</div>
								</div>
								
								<div class="row" style="margin-top: 20px;">
									<div class="col-xs-12">
										<div class="form-group text-left">
											<label for="messageInput" class="sr-only">Nhập lời chúc của bạn*</label>
											<textarea id="messageInput" name="Message" required rows="6"
											class="form-control form-control-custom"
											placeholder="Nhập lời chúc của bạn*"></textarea>
										</div>
									</div>
								</div>

								<div class="form-group text-left" style="margin-top: 60px;">
									<button type="submit" id="submitButton" class="btn btn-rose-gold">
										Gửi lời chúc &rarr;
									</button>
								</div>
								
							</form>
							<p id="postStatus" class="text-left small" style="margin-top: 15px;"></p>
						</div>
					</div>

					<div class="col-md-6">
						<div class="frame-box" style="height: 470px;">
							<div class="text-left" style="margin-bottom: 10px;">
								<h4 class="text-dark">Tin nhắn đã gửi:</h4>
							</div>
							
							<div id="messagesContainer" class="scrollable-messages">
								<p id="loadingIndicator" class="text-center text-muted">Đang tải tin nhắn...</p>
							</div>
						</div>
					</div>
					
				</div>
			</div>
			</div>
	</div>
	</div>


	<div id="fh5co-started" class="fh5co-bg" style="background-image:url(images/img_bg_4.jpg);">
		<div class="overlay"></div>
		<div class="container">
			<div class="row animate-box">
				<div class="col-md-8 col-md-offset-2 text-center fh5co-heading">
					<h2>Are You Attending?</h2>
					<p>Please Fill-up the form to notify you that you're attending. Thanks.</p>
				</div>
			</div>
			<div class="row animate-box">
				<div class="col-md-10 col-md-offset-1">
					<form class="form-inline">
						<div class="col-md-4 col-sm-4">
							<div class="form-group">
								<label for="name" class="sr-only">Name</label>
								<input type="name" class="form-control" id="name" placeholder="Name">
							</div>
						</div>
						<div class="col-md-4 col-sm-4">
							<div class="form-group">
								<label for="email" class="sr-only">Email</label>
								<input type="email" class="form-control" id="email" placeholder="Email">
							</div>
						</div>
						<div class="col-md-4 col-sm-4">
							<button type="submit" class="btn btn-default btn-block">I am Attending</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

	<div class="gototop js-top">
		<a href="#" class="js-gotop"><i class="icon-arrow-up"></i></a>
	</div>
	
	<!-- jQuery -->
	<script src="js/jquery.min.js"></script>
	<!-- jQuery Easing -->
	<script src="js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="js/bootstrap.min.js"></script>
	<!-- Waypoints -->
	<script src="js/jquery.waypoints.min.js"></script>
	<!-- Carousel -->
	<script src="js/owl.carousel.min.js"></script>
	<!-- countTo -->
	<script src="js/jquery.countTo.js"></script>

	<!-- Stellar -->
	<script src="js/jquery.stellar.min.js"></script>
	<!-- Magnific Popup -->
	<script src="js/jquery.magnific-popup.min.js"></script>
	<script src="js/magnific-popup-options.js"></script>

	<!-- // <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/0.0.1/prism.min.js"></script> -->
	<script src="js/simplyCountdown.js"></script>
	<!-- Main -->
	<script src="js/main.js"></script>
	<script src="js/petals.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>

	<script>
    var d = new Date(new Date(2025, 11, 21, 10, 30, 0));
	console.log(d)

    // default example
    simplyCountdown('.simply-countdown-one', {
        year: d.getFullYear(),
        month: d.getMonth() + 1,
        day: d.getDate()
    });

    //jQuery example
    $('#simply-countdown-losange').simplyCountdown({
        year: d.getFullYear(),
        month: d.getMonth() + 1,
        day: d.getDate(),
        enableUtc: false
    });

	document.addEventListener('DOMContentLoaded', function() {
    const header = document.getElementById('fh5co-header');
    
    // Nếu không tìm thấy header, dừng lại
    if (!header) return; 

    // Ngưỡng cuộn (scroll) mà tại đó header sẽ đổi màu
    const scrollThreshold = 100; 

    window.addEventListener('scroll', function() {
        if (window.scrollY > scrollThreshold) {
            // Thêm class khi cuộn qua ngưỡng
            header.classList.add('scrolled-header');
        } else {
            // Xóa class khi trở về đầu trang
            header.classList.remove('scrolled-header');
        }
    });

    // Kích hoạt kiểm tra lần đầu khi tải trang (phòng trường hợp trang được tải khi đang cuộn)
    window.dispatchEvent(new Event('scroll'));
});

document.addEventListener('DOMContentLoaded', () => {
    const disc = document.getElementById('discFixed');
    const audio = document.getElementById('audioFixed');
    const discContainer = document.getElementById('discContainerFixed');

    discContainer.addEventListener('click', () => {
        const isRunning = window.getComputedStyle(disc).animationPlayState === 'running';
        if (isRunning) {
            disc.style.animationPlayState = 'paused';
            audio.pause();
        } else {
            disc.style.animationPlayState = 'running';
            audio.play().catch(() => {});
        }
    });

    // Tự quay khi load
    disc.style.animationPlayState = 'running';
    audio.play().catch(() => {});
    
    // Thu nhỏ đĩa khi scroll
    window.addEventListener('scroll', () => {
        if (window.scrollY > 150) {
            discContainer.style.width = '50px';
            discContainer.style.height = '50px';
        } else {
            discContainer.style.width = '80px';
            discContainer.style.height = '80px';
        }
    });
});

// line drawing
document.addEventListener('DOMContentLoaded', () => {
        const elementsToAnimate = [
            document.getElementById('text-dang-small'),
            document.getElementById('heart-shape-small'),
            document.getElementById('text-khanh-small')
        ];

        // Đảm bảo font đã load để getTotalLength() tính toán chính xác
        document.fonts.ready.then(() => {
            elementsToAnimate.forEach(el => {
                // Kiểm tra xem phần tử có tồn tại và hỗ trợ getTotalLength không
                if (el && typeof el.getTotalLength === 'function') {
                    const len = el.getTotalLength();
                    // Đặt độ dài đường đi vào biến CSS
                    el.style.setProperty('--path-length', len);
                    // Thiết lập giá trị ban đầu cho dasharray và dashoffset
                    el.style.strokeDasharray = len;
                    el.style.strokeDashoffset = len;
                }
            });
        });
    });
$(document).ready(function() {
	
	$('.gallery-popup').magnificPopup({
		type: 'image',
		
		gallery: {
			enabled: true
		},
		
		// ĐIỀU CHỈNH CHÍNH Ở ĐÂY
		mainClass: 'mfp-with-zoom', 
		zoom: {
			enabled: true, 
			duration: 300, 
			easing: 'ease-in-out',
			
			// Trả về thẻ <li> cha (parent element) có chứa background-image
			opener: function(openerElement) { 
				// .closest('li') sẽ tìm thẻ <li> gần nhất là cha của thẻ <a> được click
				return openerElement.closest('li'); 
			}
		}
	});
});

// phần tin nhắn
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbw1C5JFCVXPBm6mjqmVMNDhk7zdW9FPeVkJIeWWdg-s7qDBLj7LQRH6EGkS13MxmHmwFA/exec';

// Hiển thị tin nhắn
function displayMessages(data){
    const container=document.getElementById('messagesContainer');
    const messages = data && Array.isArray(data) ? data : (data && ArrayOfdata(data.data) ? data.data : []);

    container.innerHTML='';

    if(messages.length===0){
        container.innerHTML='<p class="text-center text-muted p-4">Chưa có lời chúc nào.</p>';
        return;
    }
    
    // Duyệt ngược để hiển thị tin nhắn mới nhất trước
    for(let i=messages.length-1;i>=0;i--){
        const item=messages[i];
        let dateStr = item.Timestamp || 'Không rõ ngày';
        
        const card=document.createElement('div');
        card.className='message-card text-left'; 
        card.innerHTML=`
            <h5 style="color:#8c6060; margin-top: 0; margin-bottom: 5px; font-weight: bold;">
                ${item.Name || 'Ẩn Danh'}
            </h5>
            <p style="margin-bottom: 5px;">
                ${item.Message || 'Không có nội dung'}
            </p>
            <p class="small timestamp-muted" style="margin-top: 5px;">
                Gửi lúc: ${dateStr}
            </p>`;
        container.appendChild(card);
    }
}

// GET dữ liệu bằng fetch + JSON
async function fetchMessages(){
    const container=document.getElementById('messagesContainer');
    // Chỉ thêm loading indicator nếu chưa có tin nhắn nào
    if (container.children.length === 0) {
        container.innerHTML='<p id="loadingIndicator" class="text-center text-gray-500">Đang tải tin nhắn...</p>';
    }
    
    try{
        const res = await fetch(WEB_APP_URL + '?action=getMessages'); // Thêm action cho rõ ràng
        if(!res.ok) throw new Error('HTTP error '+res.status);
        const data = await res.json();
        displayMessages(data);
    }catch(err){
        console.error('Lỗi tải dữ liệu:',err);
        container.innerHTML='<p class="text-center text-red-500 p-4 font-semibold">❌ LỖI KẾT NỐI: ' + err.message + '</p>';
    }
}

// POST dữ liệu bằng fetch + FormData
async function postMessage(formData) {
    const submitBtn = document.getElementById('submitButton');
    const statusDiv = document.getElementById('postStatus');
    const form = document.getElementById('messageForm');

    submitBtn.disabled = true; submitBtn.textContent = 'Đang gửi...';
    statusDiv.className = 'mt-4 text-sm font-medium text-blue-600';
    statusDiv.textContent = 'Đang gửi tin nhắn, vui lòng chờ...';

    // Thêm 'action' vào formData để GAS biết đây là yêu cầu ghi
    formData.append('action', 'postMessage'); 

    try {
        const res = await fetch(WEB_APP_URL, {
            method: 'POST',
            body: formData // Gửi FormData trực tiếp
        });

        // GAS thường trả về HTTP 200, nhưng ta kiểm tra nội dung JSON
        const data = await res.json();

        if (data.status === 'SUCCESS') {
            statusDiv.className = 'mt-4 text-sm font-medium text-green-600';
            statusDiv.textContent = '✅ Đã gửi tin nhắn thành công!';
            form.reset();
            fetchMessages(); // Tải lại tin nhắn
        } else {
            // Xử lý lỗi trả về từ GAS
            throw new Error(data.message || 'Lỗi không xác định từ Server GAS.');
        }
    } catch (err) {
        console.error('Lỗi gửi dữ liệu:', err);
        statusDiv.className = 'mt-4 text-sm font-medium text-red-600';
        statusDiv.textContent = `❌ LỖI: Không thể gửi tin nhắn. Chi tiết: ${err.message}`;
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Gửi Lời Nhắn';
        setTimeout(() => { statusDiv.textContent = ''; }, 5000); // Xóa trạng thái sau 5s
    }
}

// DOMContentLoaded
document.addEventListener('DOMContentLoaded',()=>{
    const form=document.getElementById('messageForm');
    
    form.addEventListener('submit',(e)=>{
        e.preventDefault(); // Ngăn form submit mặc định
        const formData = new FormData(form);
        postMessage(formData);
    });
    
    fetchMessages();
});
</script>

</script>
<div class="music-player-fixed" id="discContainerFixed">
    <img id="discFixed" src="images/vinyl_record.png" alt="Music Disc">
</div>

<audio id="audioFixed" src="audio/music.mp3"></audio>
	</body>
</html>

